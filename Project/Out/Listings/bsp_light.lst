C51 COMPILER V9.56.0.0   BSP_LIGHT                                                         08/30/2017 21:49:39 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE BSP_LIGHT
OBJECT MODULE PLACED IN .\Out\Objects\bsp_light.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Bsp\src\bsp_light.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Common\i
                    -nc;..\App\inc;..\Bsp\inc;..\Startup;..\Bsp) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\Out\Listings\bsp_light.lst) O
                    -BJECT(.\Out\Objects\bsp_light.obj)

line level    source

   1          /*
   2           * bsp_light.c
   3           *
   4           *  Created on: 2017Äê8ÔÂ18ÈÕ
   5           *      Author: fly
   6           */
   7          
   8          #include "bsp.h"
   9          
  10          void Light_InitHard(void) {
  11   1      
  12   1              clr_P0M1_3;
  13   1              set_P0M2_3;
  14   1      
  15   1              clr_P0M1_4;
  16   1              set_P0M2_4;
  17   1      
  18   1              clr_P1M1_2;
  19   1              P1M2 |= SET_BIT2;
  20   1      //      set_P1M2_2;
  21   1      
  22   1              PWM0_P12_OUTPUT_ENABLE;
  23   1              PWM3_P04_OUTPUT_ENABLE
  24   1              ;
  25   1              PWM5_P03_OUTPUT_ENABLE;
  26   1      
  27   1              PWM_IMDEPENDENT_MODE;
  28   1              PWM_CLOCK_DIV_8
  29   1              ;
  30   1              PWMPH = 0x07;
  31   1              PWMPL = 0xD0;
  32   1              /**********************************************************************
  33   1               PWM frequency = Fpwm/((PWMPH,PWMPL) + 1) <Fpwm = Fsys/PWM_CLOCK_DIV>
  34   1               = (16MHz/8)/(0x7CF + 1)
  35   1               = 1KHz (1ms)
  36   1               ***********************************************************************/
  37   1      
  38   1              PWM0H = 0x01;
  39   1              PWM0L = 0xF4;
  40   1      
  41   1      //      set_SFRPAGE
  42   1      //      ;                                               //PWM4 and PWM5 duty seting is in SFP page 1
  43   1              PWM3H = 0x01;
  44   1              PWM3L = 0xD4;
  45   1              PWM5H = 0x01;
  46   1              PWM5L = 0xA4;
  47   1      //      clr_SFRPAGE
  48   1      //      ;
  49   1              // PWM output inversly enable
  50   1      //      PWM2_OUTPUT_INVERSE;
  51   1      
  52   1              //-------- PWM start run--------------
  53   1              set_LOAD;
C51 COMPILER V9.56.0.0   BSP_LIGHT                                                         08/30/2017 21:49:39 PAGE 2   

  54   1              set_PWMRUN;
  55   1      
  56   1              Light_RGB_set(0, 0, 0);
  57   1      }
  58          void Light_Red_set(uint8_t duty) {
  59   1              uint16_t d = 0;
  60   1              d = duty * 10;
  61   1      
  62   1              PWM5H = (d >> 8) & 0xFF;
  63   1              PWM5L = d & 0xFF;
  64   1              set_LOAD;
  65   1      }
  66          void Light_Green_set(uint8_t duty) {
  67   1              uint16_t d = 0;
  68   1              d = duty * 10;
  69   1      
  70   1              PWM3H = (d >> 8) & 0xFF;
  71   1              PWM3L = d & 0xFF;
  72   1              set_LOAD;
  73   1      }
  74          void Light_Blue_set(uint8_t duty) {
  75   1              uint16_t d = 0;
  76   1              d = duty * 10;
  77   1      
  78   1              PWM0H = (d >> 8) & 0xFF;
  79   1              PWM0L = d & 0xFF;
  80   1              set_LOAD;
  81   1      }
  82          
  83          void Light_RGB_set(uint8_t r, uint8_t g, uint8_t b) {
  84   1              Light_Red_set(r);
  85   1              Light_Green_set(g);
  86   1              Light_Blue_set(b);
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    174    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
